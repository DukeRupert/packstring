{{define "content"}}

{{template "admin-nav" .}}
{{template "admin-toast" .}}

<!-- Page Header -->
<section class="bg-timber">
    <div class="max-w-[1100px] mx-auto px-4 py-8 md:py-10">
        <div class="flex items-center gap-3 mb-2">
            <a href="/admin/inquiries/" class="font-ui text-[11px] uppercase tracking-[0.35em] text-cream/60 hover:text-cream transition-colors">&larr; Back</a>
        </div>
        <h1 class="font-display font-[800] text-[clamp(24px,3.5vw,36px)] leading-[1.05] text-cream">Inquiry #{{.Inquiry.ID}}</h1>
        <p class="font-body text-cream/70 text-sm mt-1">Submitted {{timeAgo .Inquiry.CreatedAt}}</p>
    </div>
</section>

<div class="max-w-[1100px] mx-auto px-4 py-8 md:py-12">
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">

        <!-- Main Column (2/3) -->
        <div class="md:col-span-2 space-y-6">

            <!-- Contact Info -->
            <div class="bg-white rounded-[4px] border border-sand-dk p-5">
                <h2 class="font-ui text-[11px] uppercase tracking-[0.35em] text-ink-faded mb-4">Contact Information</h2>
                <div class="space-y-3">
                    <div>
                        <p class="font-display font-semibold text-ink text-lg">{{.Inquiry.Name}}</p>
                    </div>
                    <div class="flex flex-col sm:flex-row gap-3">
                        <a href="mailto:{{.Inquiry.Email}}" class="inline-flex items-center gap-2 text-copper hover:text-copper-lt transition-colors min-h-[44px]">
                            <svg class="w-4 h-4 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                            </svg>
                            <span class="font-body text-sm">{{.Inquiry.Email}}</span>
                        </a>
                        {{if .Inquiry.Phone}}
                        <a href="tel:{{.Inquiry.Phone}}" class="inline-flex items-center gap-2 text-copper hover:text-copper-lt transition-colors min-h-[44px]">
                            <svg class="w-4 h-4 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
                            </svg>
                            <span class="font-body text-sm">{{.Inquiry.Phone}}</span>
                        </a>
                        {{end}}
                    </div>
                </div>
            </div>

            <!-- Trip Details -->
            <div class="bg-white rounded-[4px] border border-sand-dk p-5">
                <h2 class="font-ui text-[11px] uppercase tracking-[0.35em] text-ink-faded mb-4">Trip Details</h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    {{if .Inquiry.TripName}}
                    <div>
                        <p class="font-ui text-[10px] uppercase tracking-[0.35em] text-stone mb-1">Trip Interest</p>
                        <p class="font-body text-ink text-sm">{{.Inquiry.TripName}}</p>
                    </div>
                    {{end}}
                    {{if .Inquiry.Dates}}
                    <div>
                        <p class="font-ui text-[10px] uppercase tracking-[0.35em] text-stone mb-1">Preferred Dates</p>
                        <p class="font-body text-ink text-sm">{{.Inquiry.Dates}}</p>
                    </div>
                    {{end}}
                    {{if .Inquiry.PartySize}}
                    <div>
                        <p class="font-ui text-[10px] uppercase tracking-[0.35em] text-stone mb-1">Party Size</p>
                        <p class="font-body text-ink text-sm">{{.Inquiry.PartySize}}</p>
                    </div>
                    {{end}}
                    {{if .Inquiry.Experience}}
                    <div>
                        <p class="font-ui text-[10px] uppercase tracking-[0.35em] text-stone mb-1">Experience Level</p>
                        <p class="font-body text-ink text-sm">{{.Inquiry.Experience}}</p>
                    </div>
                    {{end}}
                </div>
            </div>

            <!-- Message -->
            {{if .Inquiry.Message}}
            <div class="bg-white rounded-[4px] border border-sand-dk p-5">
                <h2 class="font-ui text-[11px] uppercase tracking-[0.35em] text-ink-faded mb-4">Message</h2>
                <p class="font-body text-ink text-sm whitespace-pre-wrap leading-relaxed">{{.Inquiry.Message}}</p>
            </div>
            {{end}}

            <!-- Notes -->
            <div class="bg-white rounded-[4px] border border-sand-dk p-5">
                <h2 class="font-ui text-[11px] uppercase tracking-[0.35em] text-ink-faded mb-4">Your Notes</h2>
                <p class="font-body text-ink-faded text-xs mb-3">Add private notes about this inquiry. Only visible to you.</p>
                <form hx-post="/admin/inquiries/{{.Inquiry.ID}}/notes" hx-target="find button[type=submit]" hx-swap="outerHTML">
                    <textarea name="notes" rows="4" placeholder="Add notes about this inquiry..."
                        class="w-full bg-cream border border-sand-dk rounded-[4px] px-4 py-3 font-body text-ink text-sm focus:outline-none focus:border-copper focus:ring-1 focus:ring-copper transition-colors resize-y">{{.Inquiry.Notes}}</textarea>
                    <div class="mt-3">
                        <button type="submit" class="btn btn-primary">Save Notes</button>
                    </div>
                </form>
            </div>

        </div>

        <!-- Sidebar (1/3) -->
        <div class="space-y-6">

            <!-- Status -->
            <div class="bg-white rounded-[4px] border border-sand-dk p-5">
                <h2 class="font-ui text-[11px] uppercase tracking-[0.35em] text-ink-faded mb-4">Status</h2>
                <div id="inquiry-status">
                    {{template "inquiry-status" .Inquiry}}
                </div>
            </div>

            <!-- Deposit / Payment -->
            <div class="bg-white rounded-[4px] border border-sand-dk p-5">
                <h2 class="font-ui text-[11px] uppercase tracking-[0.35em] text-ink-faded mb-4">Deposit</h2>

                {{if .Payments}}
                <div class="space-y-3 mb-4">
                    {{range .Payments}}
                    <div class="p-3 rounded-[4px] border
                        {{if eq .Status "paid"}}border-forest/30 bg-forest/5
                        {{else if eq .Status "pending"}}border-copper/30 bg-copper/5
                        {{else}}border-stone/30 bg-stone/5{{end}}">
                        <div class="flex items-center justify-between mb-1">
                            <span class="font-ui text-[10px] uppercase tracking-[0.3em]
                                {{if eq .Status "paid"}}text-forest
                                {{else if eq .Status "pending"}}text-copper
                                {{else}}text-stone{{end}}">
                                {{if eq .Status "paid"}}Paid{{else if eq .Status "pending"}}Pending{{else if eq .Status "failed"}}Expired{{else}}Refunded{{end}}
                            </span>
                            <span class="font-display font-bold text-ink">{{formatCents .AmountCents}}</span>
                        </div>
                        <p class="font-body text-ink-faded text-xs">{{timeAgo .CreatedAt}}</p>
                    </div>
                    {{end}}
                </div>
                {{end}}

                {{if and .DepositConfig .DepositConfig.Enabled}}
                <div id="deposit-link-section">
                    <p class="font-body text-ink-faded text-xs mb-3">
                        Generate a payment link for {{formatCents .DepositConfig.AmountCents}} deposit.
                    </p>
                    <button hx-post="/admin/inquiries/{{.Inquiry.ID}}/deposit" hx-target="#deposit-link-section" hx-swap="beforeend"
                        class="btn btn-secondary btn-sm w-full">
                        Generate Deposit Link
                    </button>
                </div>
                {{else}}
                <p class="font-body text-ink-faded text-xs">
                    No deposit configured for this trip type.
                    <a href="/admin/deposits/" class="text-copper hover:underline">Configure deposits</a>
                </p>
                {{end}}
            </div>

        </div>
    </div>
</div>
{{end}}

{{define "inquiry-status"}}
<div>
    <!-- Current Status Badge -->
    <div class="mb-4">
        <span class="inline-block px-3 py-1.5 rounded-[4px] font-ui text-[11px] uppercase tracking-[0.3em]
            {{if eq .Status "new"}}bg-copper/10 text-copper
            {{else if eq .Status "contacted"}}bg-river/10 text-river
            {{else if eq .Status "booked"}}bg-forest/10 text-forest
            {{else}}bg-stone/10 text-stone{{end}}">
            {{statusLabel .Status}}
        </span>
    </div>

    <!-- Status Transition Buttons -->
    <div class="space-y-2">
        {{if ne .Status "contacted"}}
        <form hx-post="/admin/inquiries/{{.ID}}/status" hx-target="#inquiry-status" hx-swap="innerHTML"
              hx-confirm="Mark this inquiry as Contacted?">
            <input type="hidden" name="status" value="contacted">
            <button type="submit" class="w-full text-left px-3 py-2.5 rounded-[4px] border border-sand-dk font-ui text-[11px] uppercase tracking-[0.2em] text-ink hover:border-river hover:bg-river/5 transition-colors min-h-[44px]">
                Mark as Contacted
            </button>
        </form>
        {{end}}

        {{if ne .Status "booked"}}
        <form hx-post="/admin/inquiries/{{.ID}}/status" hx-target="#inquiry-status" hx-swap="innerHTML"
              hx-confirm="Mark this inquiry as Booked?">
            <input type="hidden" name="status" value="booked">
            <button type="submit" class="w-full text-left px-3 py-2.5 rounded-[4px] border border-sand-dk font-ui text-[11px] uppercase tracking-[0.2em] text-ink hover:border-forest hover:bg-forest/5 transition-colors min-h-[44px]">
                Mark as Booked
            </button>
        </form>
        {{end}}

        {{if ne .Status "archived"}}
        <form hx-post="/admin/inquiries/{{.ID}}/status" hx-target="#inquiry-status" hx-swap="innerHTML"
              hx-confirm="Archive this inquiry?">
            <input type="hidden" name="status" value="archived">
            <button type="submit" class="w-full text-left px-3 py-2.5 rounded-[4px] border border-sand-dk font-ui text-[11px] uppercase tracking-[0.2em] text-ink-faded hover:border-stone hover:bg-stone/5 transition-colors min-h-[44px]">
                Archive
            </button>
        </form>
        {{end}}

        {{if ne .Status "new"}}
        <form hx-post="/admin/inquiries/{{.ID}}/status" hx-target="#inquiry-status" hx-swap="innerHTML"
              hx-confirm="Reset this inquiry back to New?">
            <input type="hidden" name="status" value="new">
            <button type="submit" class="w-full text-left px-3 py-2.5 rounded-[4px] border border-sand-dk font-ui text-[11px] uppercase tracking-[0.2em] text-ink-faded hover:border-copper hover:bg-copper/5 transition-colors min-h-[44px]">
                Reset to New
            </button>
        </form>
        {{end}}
    </div>
</div>
{{end}}
